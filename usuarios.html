<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Usuarios | ControlIoT</title>
    <link href="css/prueba.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
</head>

<body class="dashboard">
    <!-- Loader superior (presentacional, opcional) -->
    <div class="top-loader" id="topLoader"><div class="bar"></div></div>
    <!-- Barra de navegación superior con menú horizontal -->
    <header class="dashboard-header">
  <div class="header-container">
    <div class="header-title">
      <h1>Usuarios<span>IoT</span></h1>
    </div>
    <nav class="main-nav" id="mainNav" aria-label="Navegación principal">
        <ul>
          <!-- Menú para ADMIN -->
          <li class="admin-only" id="navInicioAdmin"><a href="principal_admin.html"><i class="fas fa-home"></i><span>Inicio</span></a></li>
          <li class="admin-only" id="navControlAdmin"><a href="control_admin.html"><i class="fas fa-tachometer-alt"></i><span>Control</span></a></li>
          <li class="admin-only" id="navIOTAdmin"><a href="iot_admin.html"><i class="fas fa-broadcast-tower"></i><span>IoT</span></a></li>
          <li class="admin-only" id="navTablero"><a href="tablero.html"><i class="fas fa-chart-line"></i><span>Tablero</span></a></li>
          <li class="admin-only" id="navUsuarios"><a href="usuarios.html"><i class="fas fa-users-cog"></i><span>Usuarios</span></a></li>
          <li class="admin-only" id="navReportesAdmin"><a href="reportes_admin.html" class="active"><i class="fas fa-file-alt"></i><span>Reportes</span></a></li>
        </ul>
      </nav>
    <div class="user-menu">
      <div class="user-info">
        <span class="welcome-msg">Bienvenido</span>
        <span class="username" id="usernameDisplay">Cargando..</span>
      </div>
      <div class="user-avatar" id="userAvatar">
        <i class="fas fa-user-circle" id="userIcon"></i>
      </div>
      <button class="logout-btn" onclick="logout()">
        <i class="fas fa-sign-out-alt"></i>
      </button>
    </div>
  </div>
</header>

    <!-- Contenido principal -->
    <main class="dashboard-content">
        <section class="section-header">
            <h2><i class="fas fa-users-cog me-2"></i><span class="iot-gradient-text">Panel de Gestión de Usuarios</span></h2>
            <div class="last-update">
                <button type="button" class="refresh-btn icon-only" id="refreshUsers" title="Actualizar lista" aria-label="Actualizar lista">
                    <i class="fas fa-sync-alt" aria-hidden="true"></i>
                </button>
                <span>Última actualización: <span id="lastUpdateTime">Cargando...</span></span>
            </div>
        </section>

        <div class="status-cards">
            <div class="status-card">
                <div class="status-icon online">
                    <i class="fas fa-users"></i>
                </div>
                <div class="status-info">
                    <span class="status-value" id="totalUsers">0</span>
                    <span class="status-label">Usuarios registrados</span>
                </div>
            </div>
            <div class="status-card">
                <div class="status-icon normal">
                    <i class="fas fa-user-shield"></i>
                </div>
                <div class="status-info">
                    <span class="status-value" id="adminUsers">0</span>
                    <span class="status-label">Administradores</span>
                </div>
            </div>
        </div>

        <div class="user-management-container">
            <div class="user-form-section">
                <div class="form-header">
                    <h3><i class="fas fa-user-plus me-2"></i>Crear Nuevo Usuario</h3>
                    <p class="form-subtitle">Completa los campos para registrar un usuario. Revisa el rol y la seguridad de la contraseña.</p>
                </div>

                <form id="createUserForm" class="user-form" onsubmit="crearUsuario(event)">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="nombre"><i class="fas fa-user"></i> Nombre</label>
                            <input type="text" id="nombre" name="nombre" required>
                        </div>
                        <div class="form-group">
                            <label for="apellido"><i class="fas fa-user-tag"></i> Apellido</label>
                            <input type="text" id="apellido" name="apellido" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="correo"><i class="fas fa-envelope"></i> Correo electrónico</label>
                        <input type="email" id="correo" name="correo" required>
                        <small class="hint">Usa un correo corporativo válido.</small>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="password"><i class="fas fa-lock"></i> Contraseña</label>
                            <div class="password-input elevated" data-field="password">
                                <input type="password" id="password" name="password" required minlength="6">
                                <button type="button" class="toggle-password-btn" data-toggle="password" aria-label="Mostrar u ocultar contraseña" onclick="togglePassword('password')">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                            <small class="hint">Mínimo 6 caracteres. Usa mayúsculas, minúsculas y números.</small>
                        </div>
                        <div class="form-group">
                            <label for="celular"><i class="fas fa-mobile-alt"></i> Celular</label>
                            <input type="tel" id="celular" name="celular" required>
                            <small class="hint">Ej. +57 300 123 4567</small>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="rol"><i class="fas fa-user-tie"></i> Rol de usuario</label>
                        <select id="rol" name="rol" required>
                            <option value="">Seleccionar rol...</option>
                            <option value="1">Administrador</option>
                            <option value="2">Usuario estándar</option>
                        </select>
                        <small class="hint">El rol define los permisos dentro del sistema.</small>
                    </div>
                    
                    <!-- Separador visual -->
                    <div class="form-divider"></div>

                    <!-- Callout de políticas -->
                    <div class="callout info">
                        <i class="fas fa-shield-alt"></i>
                        Usa contraseñas de al menos 6 caracteres con mayúsculas, minúsculas y números. Verifica el rol antes de crear.
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save me-2"></i>Crear Usuario
                        </button>
                        <button type="reset" class="btn btn-secondary">
                            <i class="fas fa-undo me-2"></i>Limpiar
                        </button>
                    </div>
                </form>
            </div>
            
            <div class="user-list-section" style="background:#fff;border-radius:16px;box-shadow:0 2px 10px rgba(67,97,238,0.08);padding:1.5rem;">
                <div class="section-header">
                    <h3><i class="fas fa-users me-2"></i>Lista de Usuarios</h3>
                    <div class="search-box">
                        <input type="text" id="userSearch" placeholder="Buscar usuario..." onkeyup="buscarUsuarios()">
                        <button class="search-btn" title="Buscar"><i class="fas fa-search"></i></button>
                    </div>
                </div>
                <div class="table-legend" style="margin:0 0 0.5rem 0;color:#6c757d;font-size:0.9rem;">
                    Roles: <span class="badge role-admin">Administrador</span> <span class="badge role-user">Usuario</span>
                </div>
                <div class="table-container">
                    <table class="users-table">
                        <thead>
                            <tr>
                                <th>Nombre</th>
                                <th>Correo</th>
                                <th>Rol</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="usersTableBody">
                            <!-- Los usuarios se cargarán aquí dinámicamente -->
                        </tbody>
                    </table>
                </div>
                
                <div class="table-footer">
                    <div class="pagination-info" id="paginationInfo">
                        Cargando usuarios...
                    </div>
                    <div class="pagination-controls">
                        <button class="pagination-btn" id="prevPage" disabled>
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <span class="current-page" id="currentPage">1</span>
                        <button class="pagination-btn" id="nextPage">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Modal de Edición de Usuario -->
    <div class="modal" id="editUserModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-user-edit me-2"></i>Editar Usuario</h3>
                <button class="close-modal" onclick="cerrarModal('editUserModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="editUserForm" class="user-form">
                    <input type="hidden" id="editUserId">
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editNombre"><i class="fas fa-user"></i> Nombre</label>
                            <input type="text" id="editNombre" name="editNombre" required>
                        </div>
                        <div class="form-group">
                            <label for="editApellido"><i class="fas fa-user-tag"></i> Apellido</label>
                            <input type="text" id="editApellido" name="editApellido" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="editCorreo"><i class="fas fa-envelope"></i> Correo electrónico</label>
                        <input type="email" id="editCorreo" name="editCorreo" readonly>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editPassword"><i class="fas fa-lock"></i> Nueva contraseña</label>
                            <div class="password-input elevated" data-field="editPassword">
                                <input type="password" id="editPassword" name="editPassword" placeholder="Dejar en blanco para no cambiar">
                                <button type="button" class="toggle-password-btn" data-toggle="editPassword" aria-label="Mostrar u ocultar contraseña" onclick="togglePassword('editPassword')">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                            <small class="hint">Mínimo 6 caracteres</small>
                        </div>
                        <div class="form-group">
                            <label for="editCelular"><i class="fas fa-mobile-alt"></i> Celular</label>
                            <input type="tel" id="editCelular" name="editCelular" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editRol"><i class="fas fa-user-tie"></i> Rol de usuario</label>
                            <select id="editRol" name="editRol" required>
                                <option value="1">Administrador</option>
                                <option value="2">Usuario estándar</option>
                            </select>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="cerrarModal('editUserModal')">Cancelar</button>
                <button class="btn btn-primary" onclick="guardarCambios(event)">Guardar Cambios</button>
            </div>
        </div>
    </div>

    <!-- Modal de Confirmación de Eliminación -->
    <div class="modal" id="confirmDeleteModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-exclamation-triangle me-2"></i>Confirmar Eliminación</h3>
                <button class="close-modal" onclick="cerrarModal('confirmDeleteModal')">&times;</button>
            </div>
            <div class="modal-body">
                <p>¿Estás seguro que deseas eliminar al usuario <strong id="userToDelete">Nombre Usuario</strong>?</p>
                <p class="warning-text">Esta acción no se puede deshacer y el usuario perderá todo acceso al sistema.</p>
                <input type="hidden" id="deleteCorreo">
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="cerrarModal('confirmDeleteModal')">Cancelar</button>
                <button class="btn btn-danger" onclick="eliminarUsuarioConfirmado()">Eliminar Usuario</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.16/dist/sweetalert2.all.min.js"></script>
    <script src="js/scripts.js"></script>
    <script src="js/usuarios.js"></script>
    <script src="js/create.js"></script>
</body>
</html>
